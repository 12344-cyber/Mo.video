<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¬ Ù…Ø­Ø±Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­</title>
    <style>
        :root {
            --primary: #3b82f6;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --success: #10b981;
            --danger: #ef4444;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: system-ui, sans-serif; }
        body { background: var(--dark); color: var(--light); padding: 20px; min-height: 100vh; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; padding: 25px; background: rgba(255,255,255,0.05); border-radius: 16px; }
        h1 { background: linear-gradient(90deg, var(--primary) 0%, var(--success) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }
        .status-card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-top: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--success)); width: 0%; transition: width 0.3s ease; }
        .upload-area { background: rgba(255,255,255,0.05); border: 2px dashed var(--gray); border-radius: 12px; padding: 30px; text-align: center; margin-bottom: 20px; cursor: pointer; transition: all 0.3s; }
        .upload-area:hover { border-color: var(--primary); background: rgba(59, 130, 246, 0.1); }
        .upload-area.disabled { opacity: 0.5; cursor: not-allowed; }
        .message { padding: 12px 16px; border-radius: 8px; margin: 15px 0; text-align: center; display: none; }
        .message.show { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .message-success { background: rgba(16, 185, 129, 0.2); border: 1px solid var(--success); color: var(--success); }
        .message-error { background: rgba(239, 68, 68, 0.2); border: 1px solid var(--danger); color: var(--danger); }
        .message-info { background: rgba(59, 130, 246, 0.2); border: 1px solid var(--primary); color: var(--primary); }
        .controls-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin: 25px 0; }
        @media (min-width: 768px) { .controls-grid { grid-template-columns: repeat(2, 1fr); } }
        .control-panel { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .panel-title { color: var(--primary); margin-bottom: 15px; font-size: 1.2rem; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: var(--gray); font-size: 0.9rem; }
        input, select, textarea { width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.1); border: 1px solid var(--gray); border-radius: 6px; color: var(--light); font-size: 14px; }
        textarea { min-height: 80px; resize: vertical; }
        .action-buttons { display: flex; gap: 12px; margin: 25px 0; }
        .btn { flex: 1; padding: 14px 20px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), #1d4ed8); color: white; }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
        .tech-footer { margin-top: 30px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px; text-align: center; font-size: 0.8rem; color: var(--gray); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¬ Ù…Ø­Ø±Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­</h1>
            <p>Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…ØµØ­Ø­ - ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø§ÙƒÙ„</p>
        </header>

        <div class="status-card">
            <div><strong>Ø­Ø§Ù„Ø© FFmpeg:</strong> <span id="ffmpeg-status">â³ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></div>
            <div class="progress-bar"><div class="progress-fill" id="ffmpeg-progress"></div></div>
        </div>

        <div class="upload-area disabled" id="upload-area">
            <h3 id="upload-title">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø©...</h3>
            <p style="color: var(--gray); margin-top: 10px; font-size: 0.9rem;">Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠÙƒØªÙ…Ù„ ØªØ­Ù…ÙŠÙ„ FFmpeg</p>
            <input type="file" id="file-input" accept="video/*" style="display: none;">
        </div>

        <div class="message" id="system-message"></div>

        <div class="controls-grid" id="controls-grid" style="display: none;">
            <div class="control-panel">
                <div class="panel-title">ğŸ“ Ø¥Ø¶Ø§ÙØ© Ù†Øµ</div>
                <div class="form-group">
                    <label for="text-input">Ø§Ù„Ù†Øµ:</label>
                    <textarea id="text-input">Ù…Ø±Ø­Ø¨Ø§Ù‹</textarea>
                </div>
                <div class="form-group">
                    <label for="edit-type">Ù†ÙˆØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„:</label>
                    <select id="edit-type">
                        <option value="text">Ø¥Ø¶Ø§ÙØ© Ù†Øµ</option>
                        <option value="trim">Ù‚Øµ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</option>
                        <option value="reverse">Ø¹ÙƒØ³ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</option>
                    </select>
                </div>
            </div>
            <div class="control-panel">
                <div class="panel-title">âš™ï¸ Ø§Ù„ØªØ­ÙƒÙ…</div>
                <div class="form-group" id="trim-settings">
                    <label>Ù‚Øµ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Ø«Ø§Ù†ÙŠØ©):</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="start-time" min="0" value="0" style="flex: 1;">
                        <span>Ø¥Ù„Ù‰</span>
                        <input type="number" id="end-time" min="1" value="10" style="flex: 1;">
                    </div>
                </div>
            </div>
        </div>

        <div class="action-buttons" id="action-buttons" style="display: none;">
            <button class="btn btn-primary" id="apply-btn">
                <span id="apply-icon">âš¡</span>
                <span id="apply-text">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</span>
            </button>
        </div>

        <div class="tech-footer">
            <p>âœ… ØªÙ… ØªØµØ­ÙŠØ­ Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„Ù€ Worker Ø¥Ù„Ù‰ `.mjs` | âœ… ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Vercel ÙˆGitHub Pages</p>
        </div>
    </div>

    <script type="module">
        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
        let FFmpeg, toBlobURL, fetchFile;
        let ffmpeg = null;
        let isProcessing = false;

        const elements = {
            ffmpegStatus: document.getElementById('ffmpeg-status'),
            ffmpegProgress: document.getElementById('ffmpeg-progress'),
            uploadArea: document.getElementById('upload-area'),
            uploadTitle: document.getElementById('upload-title'),
            systemMessage: document.getElementById('system-message'),
            controlsGrid: document.getElementById('controls-grid'),
            actionButtons: document.getElementById('action-buttons'),
            applyBtn: document.getElementById('apply-btn'),
            applyIcon: document.getElementById('apply-icon'),
            applyText: document.getElementById('apply-text'),
            fileInput: document.getElementById('file-input')
        };

        async function initializeApp() {
            showMessage('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…...', 'info');
            
            try {
                // 1. Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙƒØªØ¨Ø© FFmpeg
                elements.ffmpegStatus.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª...';
                const ffmpegModule = await import('https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/esm/index.js');
                FFmpeg = ffmpegModule.FFmpeg;
                
                // 2. Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙƒØªØ¨Ø© Util
                const utilModule = await import('https://unpkg.com/@ffmpeg/util@0.12.1/dist/esm/index.js');
                toBlobURL = utilModule.toBlobURL;
                fetchFile = utilModule.fetchFile;
                
                showMessage('âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                // 3. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø«ÙŠÙ„ FFmpeg
                ffmpeg = new FFmpeg();
                ffmpeg.on('log', ({ message }) => console.log('[FFmpeg]', message));
                
                // 4. ØªØ­Ù…ÙŠÙ„ FFmpeg Ù…Ø¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù„Ù…Ù„ÙØ§Øª
                await loadFFmpegCore();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©:', error);
                showMessage(`âŒ ÙØ´Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©: ${error.message}`, 'error');
                elements.ffmpegStatus.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„';
                elements.ffmpegStatus.style.color = 'var(--danger)';
            }
        }

        // Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø­ÙˆØ±ÙŠØ© Ø§Ù„Ù…ÙØµÙ„Ø­Ø©: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„Ù€ Worker Ø§Ù„ØµØ­ÙŠØ­
        async function loadFFmpegCore() {
            try {
                elements.ffmpegStatus.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù†ÙˆØ§Ø© FFmpeg...';
                
                const baseURL = 'https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm';
                
                // Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: Ø§Ø³ØªØ®Ø¯Ø§Ù… .mjs Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† .js Ù„Ù…Ù„Ù Ø§Ù„Ù€ Worker
                const [coreURL, wasmURL, workerURL] = await Promise.all([
                    toBlobURL(`${baseURL}/ffmpeg-core.js`, 'text/javascript'),
                    toBlobURL(`${baseURL}/ffmpeg-core.wasm`, 'application/wasm'),
                    toBlobURL(`${baseURL}/ffmpeg-core.worker.mjs`, 'text/javascript') // ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ Ù‡Ù†Ø§
                ]);
                
                // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                let progress = 0;
                const interval = setInterval(() => {
                    progress = Math.min(progress + 10, 90);
                    elements.ffmpegProgress.style.width = `${progress}%`;
                }, 300);
                
                // ØªØ­Ù…ÙŠÙ„ FFmpeg Ù…Ø¹ Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
                await ffmpeg.load({ coreURL, wasmURL, workerURL });
                
                clearInterval(interval);
                elements.ffmpegProgress.style.width = '100%';
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                elements.ffmpegStatus.textContent = 'âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                elements.ffmpegStatus.style.color = 'var(--success)';
                elements.uploadArea.classList.remove('disabled');
                elements.uploadTitle.textContent = 'Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± ÙÙŠØ¯ÙŠÙˆ';
                elements.controlsGrid.style.display = 'grid';
                elements.actionButtons.style.display = 'flex';
                
                setupEventListeners();
                
                showMessage('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ FFmpeg Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ­Ù…ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ.', 'success');
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ FFmpeg Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù„Ù worker.mjs Ø§Ù„ØµØ­ÙŠØ­');
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ FFmpeg:', error);
                
                let errorMsg = `âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ FFmpeg: ${error.message}`;
                
                // Ø±Ø³Ø§Ø¦Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ø­Ø¯Ø¯Ø©
                if (error.message.includes('ffmpeg-core.worker')) {
                    errorMsg += '\n\nğŸ” **Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„**: Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù Ø§Ù„Ù€ Worker.';
                    errorMsg += '\nâœ… **ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­**: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØµØ­ÙŠØ­ `ffmpeg-core.worker.mjs`';
                } else if (error.message.includes('CORS') || error.message.includes('fetch')) {
                    errorMsg += '\n\nğŸ” **Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„**: Ù…Ø´ÙƒÙ„Ø© CORS ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª.';
                    errorMsg += '\nâœ… **Ø§Ù„Ø­Ù„**: ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… toBlobURL Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø­Ù„ÙŠØ§Ù‹.';
                }
                
                showMessage(errorMsg, 'error');
                elements.ffmpegStatus.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„';
                elements.ffmpegStatus.style.color = 'var(--danger)';
            }
        }

        function showMessage(text, type) {
            elements.systemMessage.textContent = text;
            elements.systemMessage.className = `message show message-${type}`;
            setTimeout(() => elements.systemMessage.classList.remove('show'), 5000);
        }

        function setupEventListeners() {
            // Ø­Ø¯Ø« ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
            elements.uploadArea.addEventListener('click', () => elements.fileInput.click());
            elements.fileInput.addEventListener('change', handleFileSelect);
            
            // Ø­Ø¯Ø« ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            elements.applyBtn.addEventListener('click', applyEdits);
        }

        async function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file || !file.type.startsWith('video/')) {
                showMessage('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ÙÙŠØ¯ÙŠÙˆ ØµØ§Ù„Ø­', 'error');
                return;
            }
            showMessage(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: ${file.name}`, 'success');
        }

        async function applyEdits() {
            if (isProcessing) return;
            isProcessing = true;
            
            try {
                elements.applyBtn.disabled = true;
                elements.applyIcon.textContent = 'â³';
                elements.applyText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';
                
                showMessage('â³ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...', 'info');
                
                // Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨ÙƒÙˆØ¯ FFmpeg Ø­Ù‚ÙŠÙ‚ÙŠ)
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                showMessage('âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
            } catch (error) {
                showMessage(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${error.message}`, 'error');
            } finally {
                elements.applyBtn.disabled = false;
                elements.applyIcon.textContent = 'âš¡';
                elements.applyText.textContent = 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„';
                isProcessing = false;
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
